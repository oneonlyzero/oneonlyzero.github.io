---
title: 3108CTF KEMBARA TUAH 2024 - Writeups
categories: [ctf, writeups]
tags: [misc]
image: /assets/thumbnails/3108ctf.png
---

One of Malaysia's Annual CTF in Conjuction of Malaysia Independent Day, 3108 was take from the date of ours beloved Malaysia Indepnedent date. This CTF is open mainly for Local Citizens only (Individual), with the theme of "14 Negeri Di Malaysia" (14 States in Malaysia) and Jeopardy format. About 902 participant  has joined and compete in this CTF. Win Infra by the [organizers](https://www.instagram.com/bahterasiber/). I categorize the challenge based on the state. 

## JOHOR 

### 1) ZZZZZZ - WEB + CRYPTO 
![image](https://github.com/user-attachments/assets/6ad6db5f-7ece-46e0-9458-158bdcc965a3)

#### Material 
> Challenge link : `https://9798fd3cc4.bahterasiber[Dot]my`

#### Solution 
> Go into the website you will see prompt the a webpage that ask a question which is "Siapa yang membunuh Sultan Mahmud pada tahun 1699?"

![image](https://github.com/user-attachments/assets/4306fc46-fa81-4680-a38d-a91145e9626a)

> Go to find answer a we found that `Laksaman Bentan` is the right answer, filled in the blank and submit. once submit the page will give us a cipher text

![image](https://github.com/user-attachments/assets/87cf4bd6-ce93-40fb-a2da-098824faaa03)

```
The cipher text : 0x33z0x31z0x30z0x380x7bz0x37z0x30z0x30z0x650x66z0x34z0x61z0x37z0x39z0x39z0x350x39z0x360x31z0x350x62z0x360x37z0x650x61z0x35z0x32z0x39z0x37z0x65z0x37z0x32z0x350x63z0x300x36z0x65z0x7dz
```

> Decode the cipher text using `Cyberchef` with `From hex` reciper to get the actual flag : `3108{700ef4a79959615b67ea5297e725c06e}`

### 2) KEKACAUAN HURUF - CRYPTO 
![image](https://github.com/user-attachments/assets/8bda4737-0608-4740-ac87-3077423f8ec1)


#### Material. 

```
Chall .py :
import random
from Crypto.Util.number import bytes_to_long, long_to_bytes

q = 64

# Read the flag from a file
flag = open("flag.txt", "rb").read()
flag_int = bytes_to_long(flag)

# Add random padding
padding_length = random.randint(5, 10)
padding = random.getrandbits(padding_length * 8)
flag_int = (flag_int << (padding_length * 8)) + padding

# Generate the secret key
secret_key = []
while flag_int:
    secret_key.append(flag_int % q)
    flag_int //= q

<-----Shuffle the secret key
original_order = list(range(len(secret_key)))
random.shuffle(original_order)
shuffled_secret_key = [secret_key[i] for i in original_order]

# Add a random offset to each value in the secret key
offset = random.randint(1, q)
shuffled_secret_key = [(x + offset) % q for x in shuffled_secret_key]

# Save the secret key and offset
with open("secret_key.txt", "w") as f:
    f.write(f"secret_key = {shuffled_secret_key}\n")
    f.write(f"offset = {offset}\n")
    f.write(f"padding_length = {padding_length}\n")
    f.write(f"original_order = {original_order}\n")

print("Secret key, offset, and original order saved to secret_key.txt")
```
```
secret_key.txt:
secret_key = [54, 38, 12, 47, 37, 37, 53, 22, 6, 38, 62, 22, 10, 54, 19, 41, 43, 53, 0, 62, 63, 28, 63, 63, 22, 10, 7, 37, 63, 53, 44, 8, 10, 42, 35, 43, 42, 63, 37, 21, 4, 19, 45, 21, 19, 18, 3, 62, 53, 24, 2, 62, 18, 35, 41, 14, 53, 3, 37, 63, 55, 62, 5]
offset = 50
padding_length = 9
original_order = [9, 20, 6, 12, 22, 38, 14, 24, 53, 52, 61, 29, 45, 11, 57, 44, 8, 46, 55, 59, 31, 2, 51, 43, 21, 27, 17, 40, 15, 58, 0, 26, 19, 36, 60, 28, 48, 39, 34, 50, 7, 16, 56, 30, 10, 49, 13, 3, 5, 42, 41, 47, 37, 4, 32, 33, 62, 1, 18, 23, 25, 35, 54]
```

#### Solution 
> Basically for this challenge is we need to reverse the encryption, here im using the CHATGPT to construct the code for me(time saver method) :

```
Solve.py :
from Crypto.Util.number import long_to_bytes
import itertools

q = 64

# Read the secret key, offset, padding length, and original order from the file
with open("secret_key.txt", "r") as f:
    lines = f.readlines()
    shuffled_secret_key = eval(lines[0].split('=')[1].strip())
    offset = int(lines[1].split('=')[1].strip())
    padding_length = int(lines[2].split('=')[1].strip())
    original_order = eval(lines[3].split('=')[1].strip())

# Reverse the random offset
secret_key = [(x - offset) % q for x in shuffled_secret_key]

# Restore the original order
restored_secret_key = [None] * len(secret_key)
for i, pos in enumerate(original_order):
    restored_secret_key[pos] = secret_key[i]

# Reconstruct the flag as an integer
flag_int = 0
for num in reversed(restored_secret_key):
    flag_int = flag_int * q + num

# Remove the padding
flag_int >>= padding_length * 8

# Convert the integer back to bytes
flag = long_to_bytes(flag_int)

print(f"Recovered flag: {flag}")
```

> Run the script and you will get the flag : `3108{9546880676d3788377699aad794c5a44}`

### 3) MALAYAN UNION - OSINT
![image](https://github.com/user-attachments/assets/1b4e88e7-7ec0-4714-bfff-3fcfb21dfc66)

#### Material 
![malayanunion-3108](https://github.com/user-attachments/assets/f51d22e9-4d60-4a47-aacc-b569137c5e86)

#### Flag Format 
> Format Flag: 3108{nama_tempat}

#### Solution 
> For this challenge, material provided is not bring you directly to the flag, it just as an lead or guide to the flag. First i visit malayan union wikiepedia to learn about the protest event. and found that the one that opposing the Malayan Union is party known as `UMNO`. `UMNO` was found by `Onn Jaafar`

![image](https://github.com/user-attachments/assets/f4e614ea-0c50-4037-b973-9d77f6ad487e)

> The challenge is inside `JOHOR` state so the place should be in `Johor` but after trying seaching for Malayan union protesting event in the `Johor`, all i got is wrong place.

> A little bit searching on the party `UMNO`, i found a link to the important events in the party `UMNO`, maybe that in that website mention about the events happen in `Johor`. I try every location mentioned in `Johor` and fortunately i got the flag.

![image](https://github.com/user-attachments/assets/acd0338a-43df-498c-860f-caa55edeb04e)

> The flag is `3108{istana_besar}` then i know that the place that we are looking for is not where the protesting event in the material happened but the place where `UMNO` was established.

### 4) KAPLA HARIMAU SELATAN - WEB 

![image](https://github.com/user-attachments/assets/d6f8e9e9-8b7a-4ce3-ac51-4820ca57e5f1)

#### Material 
> Challenge Link : `https://8303a1befe.bahterasiber[dot]my/`

#### Solution 
> Visit the link, you will see the  `Admin Access Denied` error, first step is when meet a web challenge with no source code provided is by watching the source code.

![image](https://github.com/user-attachments/assets/df16cb2a-db2b-4157-b106-ff5cef82be45)

> In the source code, there is a comment line that mentioned `<!-- reveal.txt -->`, let to go the path.

![image](https://github.com/user-attachments/assets/19052649-c476-444f-8f96-d71175584887)

> Go to the `reveal.txt`, you will see `PHP` code, here is the code with the comment of each line of code function for more understanding :

```
<?php

# Allow the script to be accessed only from a specific origin (https://127.0.0.1)
header("Access-Control-Allow-Origin: https://127.0.0.1");

# Define the header name we want to check ('Origin')
$headerName = 'Origin';

# Define the expected value of the 'Origin' header
$headerValue = 'https://127.0.0.1';

# Define a secondary custom header name we want to check ('X-Custom-Header')
$secondaryHeaderName = 'X-Custom-Header';

# Define the expected value of the 'X-Custom-Header', which is base64 encoded
$secondaryHeaderValue = 'Sm9ob3IganVnYSBkaWtlbmFsaSBzZWJhZ2FpIEdfX19fX19fIG9sZWggb3JhbmcgU2lhbQ==';

# Convert the 'Origin' header name to a format suitable for the $_SERVER array
# (e.g., 'Origin' -> 'HTTP_ORIGIN')
$headerKey = 'HTTP_' . strtoupper(str_replace('-', '_', $headerName));

# Convert the 'X-Custom-Header' name to a format suitable for the $_SERVER array
# (e.g., 'X-Custom-Header' -> 'HTTP_X_CUSTOM_HEADER')
$secondaryHeaderKey = 'HTTP_' . strtoupper(str_replace('-', '_', $secondaryHeaderName));

# Check if both the expected headers exist in the request
if (isset($_SERVER[$headerKey]) && isset($_SERVER[$secondaryHeaderKey])) {

    # Retrieve the actual value of the 'Origin' header from the request
    $actualValue = $_SERVER[$headerKey];

    # Retrieve the actual value of the 'X-Custom-Header' from the request
    $actualSecondaryValue = $_SERVER[$secondaryHeaderKey];

    # Compare the actual values to the expected values
    if ($actualValue === $headerValue && $actualSecondaryValue === $secondaryHeaderValue) {
        # If both headers match the expected values, output the flag
        echo "The flag is 3108{this-is-fake-flag}";
    } else {
        # If the headers exist but don't match the expected values, output "Close enough"
        echo "Close enough";
    }
} else {
    # If one or both headers are missing, output "Denied!"
    echo "Denied!";
}

?>
```

> Decode the base64 encoding at the custom header : `Sm9ob3IganVnYSBkaWtlbmFsaSBzZWJhZ2FpIEdfX19fX19fIG9sZWggb3JhbmcgU2lhbQ==` , you will get `Johor juga dikenali sebagai G_______ oleh orang Siam`. Its look like a question and we need to fill in the blank and use it as our custom header.

> Try to find the answer for that question on google and we find that the answer is : `Gangganu`, at first using `curl` command i try to use the full text as the custom header like this and all i got as a return is `Close Enough` response from the server.:

```
First Attempt : curl -H "Origin: https://127.0.0.1" -H "X-Custom-Header: Johor juga dikenali sebagai Gangganu oleh orang Siam" https://8303a1befe.bahterasiber[dot]my/

Respone : Close Enough !
```
>   but then i try to use only the answer which is the `Gangganu` as our custom header adn yup we got the flag :

```
Second Attempt : curl -H "Origin: https://127.0.0.1" -H "X-Custom-Header: Gangganu " https://8303a1befe.bahterasiber[dot]my/

Respone :  The flag is 3108{d941697cea9e3f341864780b68416961}
```

## KEDAH 

### 1) WORDLE BAHASA UTARA - WEB 
![image](https://github.com/user-attachments/assets/73b2dba4-1a4e-422f-b51f-8d876a5942f0)

#### Materials 

> Challenge link : `https://7e6d97fe1f.bahterasiber[dot]my/`

#### Solution 

> For this challenge basically a game to guess the `Utara` words and obtain the flag which is like word wordle game. Guess the right words and you get the flag : `3108{h4ng_m3m4ng_s3mp0i}`

![image](https://github.com/user-attachments/assets/e6c07b21-c653-485f-a1d6-8efad278f878)

## KELANTAN

### 1) SULTAN YANG HILANG - WEB 

![image](https://github.com/user-attachments/assets/bc439ff9-f8c5-4e7c-ae0c-42f9538676cf)

#### Material 

> Challenge Link : `https://f2add8dd3a.bahterasiber[dot]my/`

#### Solution 

> In the source code, we will be given a javascript code, below in the js code with comment in each line for better understanding  :

```
# Array of years for which the names of Sultans will be fetched
const sultanYears = [1763, 1795, 1800, 1835, 1837, 1886, 1890, 1899, 1920, 1944, 1960, 1979, 2010];

# Loop through each year in the sultanYears array
sultanYears.forEach(year => {
    # Fetch the data from the API endpoint for the current year
    fetch(`/api/v1/sultan/${year}`)
        # Convert the response to JSON format
        .then(response => response.json())
        # Handle the JSON data returned from the API
        .then(data => {
            # Get the HTML element with the id 'sultan-list'
            const list = document.getElementById('sultan-list');
            # Create a new list item element
            const listItem = document.createElement('li');
            # If the response contains an error, display the error message
            if (data.error) {
                listItem.textContent = `${data.error}`;
            } else {
                # Otherwise, display the Sultan's name
                listItem.textContent = `${data.nama}`;
            }
            # Append the list item to the 'sultan-list' element
            list.appendChild(listItem);
        })
        # Log any errors that occur during the fetch or processing
        .catch(error => console.error('Error:', error));
});
```

> The website will fetch the sultan name based on the year, in the challenge description mentioned that there is one sultan that missing in that list, go to  `sultan kelantan wikiepdia`, and notice that the missing sultan is `Sultan Muhammad iii` who ruled the state with the least period than the others sultan which is from year `1889 - 1890`. 

![image](https://github.com/user-attachments/assets/55755caf-a129-46e7-8a48-f2635734010d)

> Notice that the `sultanYears` array consist of the year where each of the sultan started `year` became the sultan. `The missing sultan` started `year` was `1889` and was not include in the array. The API will fetch the sultan name based on the `year` so let fetch the missing sultan by using the year `1889`.

> use the path of the API path and the year of the missing sultan : `https://f2add8dd3a.bahterasiber[dot]my/api/v1/sultan/1889`, You will get the flag : `3108{putera_sulong_Sultan_Ahmad}`

## MELAKA

### 1) PERIGI - OSINT 

![image](https://github.com/user-attachments/assets/e69590ce-6128-4bc8-bc95-95fc7e0a186a)


#### Material 

> Locked Zip file.

#### Solution 

> For this we need to find the password to unlock the zip file to get the flag, based on the description, the password hint is to find the `The country that poisoned the well for the second time`. Since this challenge was in the Melaka state category so the well must be located in Melaka and the well mentioned was `Perigi Hang Li Po`.

> A little bit searching on the history of `Perigi Hang Li po`, i found a facebook that told us about the well has been poisoned event :

![image](https://github.com/user-attachments/assets/2cbd73ad-2771-4a78-a557-6a1f3ebcb6e8)

> Based on the story, The first one who poisoned the well was `Johor`,followed by `Belanda` and `Acheh`, so the second one is `Belanda`, use it as the password of the zip file and we got the flag : `3108{th3_k1ngs_w3ll_st4ys_0n}`

 
### 2) HANG TAK TIDUR LAGI? - WEB 
![image](https://github.com/user-attachments/assets/3c05538b-b22e-4da9-bf17-2b1e469a9356) 

#### Material 

> Challenge link : `https://fc9044a5b6.bahterasiber[dot]my/`

#### Solution 

> view the source code we will get login credentials : `tuah:tuah`, login using the credentials, the servers response that we dont have access to the flag. In the webpage mentioned asked with the title of "Laksamana", so maybe this kind of role, using developer tools and view the `cookie` section, we can view the `role` sections.

> When login as `tuah`, the role that we got is `JRAUWU2BJVAU4QI=`, seem like an encoded text, decode the text with base32, we get the role in plaintext : `LAKSAMANA`, maybe we can change the role to another role, but what is the roles?. In the chall description mentioned about meeting the others `Pembesar berempat`. try to google and we found that in the `Kesultanan Melayu Melaka` , sultan ruled a country along side with the help of the `Pembesar Berempat` known as `Bendahara, Penghulu Bendahari, Temenggung & Laksamana`.

> To solve the challenge, i convert each `Pembesar Berempat` roles except for `Laksamana` to base32 and URL Encode it and change the value of the `role` in the `cookie` one by one. and we will get the flag, part by part. Combine all the 3 parts and we get the final flag : `3108{1d0R_s4nGa7l4h_Bah4y4!}`

 ![image](https://github.com/user-attachments/assets/a486607a-673a-4a61-8951-02ee06f9a45d)


